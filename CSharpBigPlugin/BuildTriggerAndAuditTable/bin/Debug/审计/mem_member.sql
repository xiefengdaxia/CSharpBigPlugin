--2016-12-07 11:46:38 : 
if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[Audit_mem_member]'))
drop table [dbo].[Audit_mem_member]
GO
CREATE TABLE [dbo].[Audit_mem_member](
[auditID] [numeric](18, 0) PRIMARY KEY IDENTITY(1,1) NOT NULL,
[action] [varchar](50) NULL,
[from] [varchar](100) NULL,
[auditTimestamp] [datetime] NULL,
[m_id] [nvarchar](18) NULL,
[tickh] [nvarchar](30) NULL,
[mem_id] [tinyint] NULL,
[m_id_type] [tinyint] NULL,
[mem_iden] [nvarchar](5) NULL,
[card_ext] [nvarchar](4) NULL,
[namee] [nvarchar](60) NULL,
[namec] [nvarchar](60) NULL,
[nameelast] [nvarchar](15) NULL,
[q_id] [nvarchar](26) NULL,
[main_id] [nvarchar](18) NULL,
[first_mid] [nvarchar](18) NULL,
[sys_id] [numeric](18,0) NULL,
[cardhold] [tinyint] NULL,
[if_hide] [tinyint] NULL,
[sortorder] [int] NULL,
[familys] [tinyint] NULL,
[nominee] [tinyint] NULL,
[company_buy] [int] NULL,
[no_name] [int] NULL,
[order_text] [nvarchar](50) NULL,
[picture] [nvarchar](20) NULL,
[user_id] [nvarchar](26) NULL,
[user_time] [datetime] NULL,
[sex] [nvarchar](1) NULL,
[passport] [nvarchar](20) NULL,
[id] [nvarchar](25) NULL,
[birthday] [datetime] NULL,
[birth_zone] [nvarchar](15) NULL,
[titlec] [nvarchar](50) NULL,
[titlee] [nvarchar](50) NULL,
[nation] [nvarchar](15) NULL,
[memberkind] [tinyint] NULL,
[status] [tinyint] NULL,
[mem_period] [int] NULL,
[club_id] [nvarchar](8) NULL,
[pin_id] [nvarchar](16) NULL,
[certification] [nvarchar](15) NULL,
[data_input] [datetime] NULL,
[autho_indate] [datetime] NULL,
[autho_name] [nvarchar](10) NULL,
[joindate] [datetime] NULL,
[introdu_iden] [nvarchar](5) NULL,
[introducer] [nvarchar](40) NULL,
[introdu_memid] [nvarchar](18) NULL,
[sale_name] [nvarchar](16) NULL,
[issue_date] [datetime] NULL,
[if_closedate] [nvarchar](1) NULL,
[closedate] [datetime] NULL,
[status_date] [datetime] NULL,
[mem_password] [nvarchar](10) NULL,
[iccard_no] [nvarchar](24) NULL,
[issue_card] [int] NULL,
[autho_date] [datetime] NULL,
[autho_type] [int] NULL,
[autho_id] [int] NULL,
[autho_no] [nvarchar](10) NULL,
[check_no] [nvarchar](18) NULL,
[bank_name] [nvarchar](30) NULL,
[tel] [nvarchar](200) NULL,
[fax] [nvarchar](25) NULL,
[mobilphone] [nvarchar](25) NULL,
[address] [nvarchar](500) NULL,
[co_tel] [nvarchar](200) NULL,
[co_fax] [nvarchar](100) NULL,
[co_address] [nvarchar](500) NULL,
[co_poscode] [nvarchar](20) NULL,
[pobox] [nvarchar](500) NULL,
[certno] [nvarchar](10) NULL,
[mailto_label] [tinyint] NULL,
[mailto] [tinyint] NULL,
[mailto_magazine] [tinyint] NULL,
[blood_type] [nvarchar](2) NULL,
[from_country] [nvarchar](50) NULL,
[from_zone] [nvarchar](15) NULL,
[from_city] [nvarchar](10) NULL,
[stay_country] [nvarchar](50) NULL,
[stay_zone] [nvarchar](15) NULL,
[stay_city] [nvarchar](10) NULL,
[maritus] [tinyint] NULL,
[marrydate] [datetime] NULL,
[edu_grade] [nvarchar](10) NULL,
[hobby] [nvarchar](60) NULL,
[nickname] [nvarchar](10) NULL,
[spouse] [nvarchar](40) NULL,
[children] [nvarchar](50) NULL,
[e_mail] [nvarchar](50) NULL,
[postcode] [nvarchar](20) NULL,
[car] [nvarchar](20) NULL,
[language] [nvarchar](20) NULL,
[home_page] [nvarchar](30) NULL,
[park] [int] NULL,
[park_no] [nvarchar](10) NULL,
[native_place] [nvarchar](20) NULL,
[master_language] [nvarchar](20) NULL,
[race] [nvarchar](20) NULL,
[link_no] [nvarchar](20) NULL,
[co_namec] [nvarchar](75) NULL,
[co_namee] [nvarchar](75) NULL,
[co_departmemt] [nvarchar](20) NULL,
[co_position] [nvarchar](50) NULL,
[co_prof] [nvarchar](20) NULL,
[co_beeper] [nvarchar](40) NULL,
[co_mobil] [nvarchar](100) NULL,
[co_prop] [nvarchar](3) NULL,
[office] [nvarchar](10) NULL,
[salary] [numeric](10,0) NULL,
[co_office] [nvarchar](20) NULL,
[incomes] [numeric](9,0) NULL,
[company_no] [nvarchar](30) NULL,
[found_date] [datetime] NULL,
[company_trade] [nvarchar](30) NULL,
[company_scale] [nvarchar](30) NULL,
[company_depute] [nvarchar](30) NULL,
[company_follows] [int] NULL,
[business_prop] [nvarchar](30) NULL,
[register_no] [nvarchar](20) NULL,
[billtocard] [nvarchar](18) NULL,
[rights] [nvarchar](1) NULL,
[credit_limit] [numeric](11,2) NULL,
[money_id] [nvarchar](3) NULL,
[co_enterfee] [numeric](9,2) NULL,
[co_security] [numeric](9,2) NULL,
[co_enterpaydate] [datetime] NULL,
[security] [int] NULL,
[co_enterendate] [datetime] NULL,
[co_periods] [int] NULL,
[co_paiedperiods] [int] NULL,
[co_paiedamt] [numeric](8,1) NULL,
[startmonthdate] [datetime] NULL,
[endmonthdate] [datetime] NULL,
[mfee_money] [nvarchar](3) NULL,
[monthfee] [numeric](10,2) NULL,
[mthyr] [nvarchar](10) NULL,
[renderway] [nvarchar](10) NULL,
[mfee_paiedamt] [numeric](8,1) NULL,
[call_times] [int] NULL,
[mem_paytype] [nvarchar](10) NULL,
[mem_owes] [numeric](8,1) NULL,
[open_bank] [nvarchar](30) NULL,
[open_office] [nvarchar](30) NULL,
[open_company] [nvarchar](30) NULL,
[open_billno] [nvarchar](30) NULL,
[open_credit] [nvarchar](30) NULL,
[open_creditno] [nvarchar](30) NULL,
[open_endate] [datetime] NULL,
[remark] [nvarchar](500) NULL,
[pos_tips] [nvarchar](200) NULL,
[pos_tips_type] [tinyint] NULL,
[spare_no1] [nvarchar](20) NULL,
[spare_no2] [nvarchar](20) NULL,
[packet_no] [nvarchar](10) NULL,
[lease_endate] [datetime] NULL,
[hcap_refer] [numeric](4,1) NULL,
[hcap] [numeric](4,1) NULL,
[consum_amts] [numeric](8,1) NULL,
[consum_times] [numeric](6,0) NULL,
[user_content] [nvarchar](20) NULL,
[relative] [nvarchar](10) NULL,
[term] [nvarchar](2) NULL,
[beeper] [nvarchar](25) NULL,
[account_tips] [numeric](11,2) NULL,
[reminder] [tinyint] NULL,
[zone] [nvarchar](15) NULL,
[city] [nvarchar](10) NULL,
[card_date] [datetime] NULL,
[spell] [nvarchar](10) NULL,
[co_countrycat] [nvarchar](10) NULL,
[co_postcode] [nvarchar](20) NULL,
[co_attn] [nvarchar](35) NULL,
[co_rep] [nvarchar](35) NULL,
[coupon] [nvarchar](10) NULL,
[title] [nvarchar](35) NULL,
[expiry_date] [datetime] NULL,
[renewed_date] [datetime] NULL,
[cancelled_date] [datetime] NULL,
[handledby] [nchar](50) NULL,
[application] [datetime] NULL,
[co_attn_2] [nvarchar](40) NULL,
[other_address] [nvarchar](200) NULL,
[other_postcode] [nvarchar](20) NULL,
[other_attn] [nvarchar](40) NULL,
[other_tel] [nvarchar](20) NULL,
[other_address2] [nvarchar](200) NULL,
[other_postcode2] [nvarchar](20) NULL,
[other_attn2] [nvarchar](40) NULL,
[other_tel2] [nvarchar](20) NULL,
[houseid] [nchar](6) NULL,
[housebank] [nvarchar](30) NULL,
[paytimelimit] [nchar](5) NULL,
[housetype] [nvarchar](20) NULL,
[housemoneytype] [nvarchar](20) NULL,
[housesalemoney] [money] NULL,
[buytime] [datetime] NULL,
[yearperiod] [nvarchar](10) NULL,
[posjustify] [nchar](1) NULL,
[wherefrom] [nvarchar](30) NULL,
[cohap] [numeric](4,1) NULL,
[trytimes] [nchar](1) NULL,
[ballbagnum] [nvarchar](30) NULL,
[othername] [nvarchar](60) NULL,
[tcredit_limit] [numeric](10,0) NULL,
[mcredit_limit] [numeric](10,0) NULL,
[dqcs] [int] NULL,
[jrcs] [int] NULL,
[source] [varchar](30) NULL,
[homeaddr] [varchar](200) NULL,
[hometel] [varchar](30) NULL,
[homepostcode] [varchar](20) NULL,
[modify] [varchar](26) NULL,
[modifytime] [datetime] NULL,
[contactperiod] [varchar](50) NULL,
[contactway] [varchar](5) NULL,
[linkman] [varchar](15) NULL,
[site] [varchar](30) NULL,
[linktime] [datetime] NULL,
[recommend] [tinyint] NULL,
[introdusid] [varchar](18) NULL,
[cardsno] [decimal](10,0) NULL,
[cardbalance] [numeric](9,2) NULL,
[signertype] [tinyint] NULL,
[couponno] [varchar](20) NULL,
[coupontype] [tinyint] NULL,
[couponpay] [numeric](9,2) NULL,
[depositcard] [tinyint] NULL,
[fEntityNo] [varchar](10) NULL,
[pcno] [varchar](10) NULL,
[fcreatedate] [datetime] NULL,
[fmodifydate] [datetime] NULL,
[fDeptNo] [varchar](10) NULL,
[fUserNo] [varchar](10) NULL,
[n_last] [numeric](18,0) NULL,
[ifdown] [char](4) NULL,
[setautoid] [varchar](60) NULL,
[Web_UType] [int] NULL,
[FClub] [varchar](12) NULL,
[Fpcno] [varchar](10) NULL,
[specialflag] [tinyint] NULL,
[fbillNo] [nvarchar](26) NULL,
[finout] [char](1) NULL,
[fhyinmpno] [varchar](20) NULL,
[Sicardno] [varchar](20) NULL,
[ftickh] [varchar](18) NULL,
[statusinout] [int] NULL,
[fpowerdoor] [int] NULL,
[fifygmp] [int] NULL,
[fbillNosub] [varchar](26) NULL,
[factive] [int] NULL,
[fvisibleacc] [int] NULL,
[factivedate] [datetime] NULL,
[jecountall] [decimal](18,2) NULL,
[fyjje] [numeric](18,2) NULL,
[mem_password1] [varchar](20) NULL,
[cardbalancezs] [numeric](9,2) NULL,
[fgzjeall] [decimal](18,2) NULL,
[spcdxhje] [decimal](18,2) NULL,
[Fstatustype] [tinyint] NULL,
[fnewhyje] [decimal](18,2) NULL,
[factdate] [datetime] NULL,
[fstudentno] [nvarchar](26) NULL,
[ifhyyjje] [int] NULL)
GO
IF EXISTS(select * from sysobjects where type='tr' and name='TGR_mem_member_INSERT')
DROP  TRIGGER TGR_mem_member_INSERT
GO
CREATE TRIGGER TGR_mem_member_INSERT
ON [mem_member] FOR INSERT
AS
BEGIN
DECLARE @from VARCHAR(100)
SELECT @from=(SELECT '客户机名:'+rtrim(hostname)+' 程序名:'+program_name FROM master..sysprocesses WHERE spid=(SELECT @@SPID))
INSERT INTO Audit_mem_member SELECT 'INSERT',@from,GETDATE(),m_id,tickh,mem_id,m_id_type,mem_iden,card_ext,namee,namec,nameelast,q_id,main_id,first_mid,sys_id,cardhold,if_hide,sortorder,familys,nominee,company_buy,no_name,order_text,picture,user_id,user_time,sex,passport,id,birthday,birth_zone,titlec,titlee,nation,memberkind,status,mem_period,club_id,pin_id,certification,data_input,autho_indate,autho_name,joindate,introdu_iden,introducer,introdu_memid,sale_name,issue_date,if_closedate,closedate,status_date,mem_password,iccard_no,issue_card,autho_date,autho_type,autho_id,autho_no,check_no,bank_name,tel,fax,mobilphone,address,co_tel,co_fax,co_address,co_poscode,pobox,certno,mailto_label,mailto,mailto_magazine,blood_type,from_country,from_zone,from_city,stay_country,stay_zone,stay_city,maritus,marrydate,edu_grade,hobby,nickname,spouse,children,e_mail,postcode,car,language,home_page,park,park_no,native_place,master_language,race,link_no,co_namec,co_namee,co_departmemt,co_position,co_prof,co_beeper,co_mobil,co_prop,office,salary,co_office,incomes,company_no,found_date,company_trade,company_scale,company_depute,company_follows,business_prop,register_no,billtocard,rights,credit_limit,money_id,co_enterfee,co_security,co_enterpaydate,security,co_enterendate,co_periods,co_paiedperiods,co_paiedamt,startmonthdate,endmonthdate,mfee_money,monthfee,mthyr,renderway,mfee_paiedamt,call_times,mem_paytype,mem_owes,open_bank,open_office,open_company,open_billno,open_credit,open_creditno,open_endate,remark,pos_tips,pos_tips_type,spare_no1,spare_no2,packet_no,lease_endate,hcap_refer,hcap,consum_amts,consum_times,user_content,relative,term,beeper,account_tips,reminder,zone,city,card_date,spell,co_countrycat,co_postcode,co_attn,co_rep,coupon,title,expiry_date,renewed_date,cancelled_date,handledby,application,co_attn_2,other_address,other_postcode,other_attn,other_tel,other_address2,other_postcode2,other_attn2,other_tel2,houseid,housebank,paytimelimit,housetype,housemoneytype,housesalemoney,buytime,yearperiod,posjustify,wherefrom,cohap,trytimes,ballbagnum,othername,tcredit_limit,mcredit_limit,dqcs,jrcs,source,homeaddr,hometel,homepostcode,modify,modifytime,contactperiod,contactway,linkman,site,linktime,recommend,introdusid,cardsno,cardbalance,signertype,couponno,coupontype,couponpay,depositcard,fEntityNo,pcno,fcreatedate,fmodifydate,fDeptNo,fUserNo,n_last,ifdown,setautoid,Web_UType,FClub,Fpcno,specialflag,fbillNo,finout,fhyinmpno,Sicardno,ftickh,statusinout,fpowerdoor,fifygmp,fbillNosub,factive,fvisibleacc,factivedate,jecountall,fyjje,mem_password1,cardbalancezs,fgzjeall,spcdxhje,Fstatustype,fnewhyje,factdate,fstudentno,ifhyyjje FROM INSERTED
End
GO
IF EXISTS(select * from sysobjects where type='tr' and name='TGR_mem_member_UPDATE')
DROP  TRIGGER TGR_mem_member_UPDATE
GO
CREATE TRIGGER TGR_mem_member_UPDATE
ON [mem_member] FOR UPDATE
AS
BEGIN
DECLARE @from VARCHAR(100)
SELECT @from=(SELECT '客户机名:'+rtrim(hostname)+' 程序名:'+program_name FROM master..sysprocesses WHERE spid=(SELECT @@SPID))
INSERT INTO Audit_mem_member SELECT 'UPDATE',@from,GETDATE(),m_id,tickh,mem_id,m_id_type,mem_iden,card_ext,namee,namec,nameelast,q_id,main_id,first_mid,sys_id,cardhold,if_hide,sortorder,familys,nominee,company_buy,no_name,order_text,picture,user_id,user_time,sex,passport,id,birthday,birth_zone,titlec,titlee,nation,memberkind,status,mem_period,club_id,pin_id,certification,data_input,autho_indate,autho_name,joindate,introdu_iden,introducer,introdu_memid,sale_name,issue_date,if_closedate,closedate,status_date,mem_password,iccard_no,issue_card,autho_date,autho_type,autho_id,autho_no,check_no,bank_name,tel,fax,mobilphone,address,co_tel,co_fax,co_address,co_poscode,pobox,certno,mailto_label,mailto,mailto_magazine,blood_type,from_country,from_zone,from_city,stay_country,stay_zone,stay_city,maritus,marrydate,edu_grade,hobby,nickname,spouse,children,e_mail,postcode,car,language,home_page,park,park_no,native_place,master_language,race,link_no,co_namec,co_namee,co_departmemt,co_position,co_prof,co_beeper,co_mobil,co_prop,office,salary,co_office,incomes,company_no,found_date,company_trade,company_scale,company_depute,company_follows,business_prop,register_no,billtocard,rights,credit_limit,money_id,co_enterfee,co_security,co_enterpaydate,security,co_enterendate,co_periods,co_paiedperiods,co_paiedamt,startmonthdate,endmonthdate,mfee_money,monthfee,mthyr,renderway,mfee_paiedamt,call_times,mem_paytype,mem_owes,open_bank,open_office,open_company,open_billno,open_credit,open_creditno,open_endate,remark,pos_tips,pos_tips_type,spare_no1,spare_no2,packet_no,lease_endate,hcap_refer,hcap,consum_amts,consum_times,user_content,relative,term,beeper,account_tips,reminder,zone,city,card_date,spell,co_countrycat,co_postcode,co_attn,co_rep,coupon,title,expiry_date,renewed_date,cancelled_date,handledby,application,co_attn_2,other_address,other_postcode,other_attn,other_tel,other_address2,other_postcode2,other_attn2,other_tel2,houseid,housebank,paytimelimit,housetype,housemoneytype,housesalemoney,buytime,yearperiod,posjustify,wherefrom,cohap,trytimes,ballbagnum,othername,tcredit_limit,mcredit_limit,dqcs,jrcs,source,homeaddr,hometel,homepostcode,modify,modifytime,contactperiod,contactway,linkman,site,linktime,recommend,introdusid,cardsno,cardbalance,signertype,couponno,coupontype,couponpay,depositcard,fEntityNo,pcno,fcreatedate,fmodifydate,fDeptNo,fUserNo,n_last,ifdown,setautoid,Web_UType,FClub,Fpcno,specialflag,fbillNo,finout,fhyinmpno,Sicardno,ftickh,statusinout,fpowerdoor,fifygmp,fbillNosub,factive,fvisibleacc,factivedate,jecountall,fyjje,mem_password1,cardbalancezs,fgzjeall,spcdxhje,Fstatustype,fnewhyje,factdate,fstudentno,ifhyyjje FROM INSERTED
End
GO

IF EXISTS(select * from sysobjects where type='tr' and name='TGR_mem_member_DELETE')
DROP  TRIGGER TGR_mem_member_DELETE
GO
CREATE TRIGGER TGR_mem_member_DELETE
ON [mem_member] FOR DELETE
AS
BEGIN
DECLARE @from VARCHAR(100)
SELECT @from=(SELECT '客户机名:'+rtrim(hostname)+' 程序名:'+program_name FROM master..sysprocesses WHERE spid=(SELECT @@SPID))
INSERT INTO Audit_mem_member SELECT 'DELETE',@from,GETDATE(),m_id,tickh,mem_id,m_id_type,mem_iden,card_ext,namee,namec,nameelast,q_id,main_id,first_mid,sys_id,cardhold,if_hide,sortorder,familys,nominee,company_buy,no_name,order_text,picture,user_id,user_time,sex,passport,id,birthday,birth_zone,titlec,titlee,nation,memberkind,status,mem_period,club_id,pin_id,certification,data_input,autho_indate,autho_name,joindate,introdu_iden,introducer,introdu_memid,sale_name,issue_date,if_closedate,closedate,status_date,mem_password,iccard_no,issue_card,autho_date,autho_type,autho_id,autho_no,check_no,bank_name,tel,fax,mobilphone,address,co_tel,co_fax,co_address,co_poscode,pobox,certno,mailto_label,mailto,mailto_magazine,blood_type,from_country,from_zone,from_city,stay_country,stay_zone,stay_city,maritus,marrydate,edu_grade,hobby,nickname,spouse,children,e_mail,postcode,car,language,home_page,park,park_no,native_place,master_language,race,link_no,co_namec,co_namee,co_departmemt,co_position,co_prof,co_beeper,co_mobil,co_prop,office,salary,co_office,incomes,company_no,found_date,company_trade,company_scale,company_depute,company_follows,business_prop,register_no,billtocard,rights,credit_limit,money_id,co_enterfee,co_security,co_enterpaydate,security,co_enterendate,co_periods,co_paiedperiods,co_paiedamt,startmonthdate,endmonthdate,mfee_money,monthfee,mthyr,renderway,mfee_paiedamt,call_times,mem_paytype,mem_owes,open_bank,open_office,open_company,open_billno,open_credit,open_creditno,open_endate,remark,pos_tips,pos_tips_type,spare_no1,spare_no2,packet_no,lease_endate,hcap_refer,hcap,consum_amts,consum_times,user_content,relative,term,beeper,account_tips,reminder,zone,city,card_date,spell,co_countrycat,co_postcode,co_attn,co_rep,coupon,title,expiry_date,renewed_date,cancelled_date,handledby,application,co_attn_2,other_address,other_postcode,other_attn,other_tel,other_address2,other_postcode2,other_attn2,other_tel2,houseid,housebank,paytimelimit,housetype,housemoneytype,housesalemoney,buytime,yearperiod,posjustify,wherefrom,cohap,trytimes,ballbagnum,othername,tcredit_limit,mcredit_limit,dqcs,jrcs,source,homeaddr,hometel,homepostcode,modify,modifytime,contactperiod,contactway,linkman,site,linktime,recommend,introdusid,cardsno,cardbalance,signertype,couponno,coupontype,couponpay,depositcard,fEntityNo,pcno,fcreatedate,fmodifydate,fDeptNo,fUserNo,n_last,ifdown,setautoid,Web_UType,FClub,Fpcno,specialflag,fbillNo,finout,fhyinmpno,Sicardno,ftickh,statusinout,fpowerdoor,fifygmp,fbillNosub,factive,fvisibleacc,factivedate,jecountall,fyjje,mem_password1,cardbalancezs,fgzjeall,spcdxhje,Fstatustype,fnewhyje,factdate,fstudentno,ifhyyjje FROM DELETED
End
GO



